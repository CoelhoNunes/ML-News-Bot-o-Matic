name: ML Reddit Digest Bot

on:
  schedule:
    - cron: '*/5 * * * *'    # every 5 minutes UTC
  workflow_dispatch:        # manual “Run workflow” button

jobs:
  run-and-commit:
    runs-on: ubuntu-latest

    env:
      REDDIT_USER_AGENT: reddit-yourbot-agent
      SEARCH_QUERY: >-
        AI OR artificial intelligence OR machine learning OR deep learning OR
        reinforcement learning OR neural network OR NLP OR computer vision OR
        robotics OR data science OR quantum computing OR research OR
        tutorial OR jobs OR career OR interview OR challenge
      SEARCH_LIMIT: '100'
      TOP_COMMENTS: '5'

    steps:
      - uses: actions/checkout@v3

      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: Run digest generator
        run: python src/digest_generator.py

      - name: Commit & push new files
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          git config user.name  "${{ github.actor }}"
          git config user.email "${{ github.actor }}@users.noreply.github.com"
          git add digests/*.md data/*.json data/seen_ids.json
          git commit -m "chore: add new digests" || echo "No changes to commit"
          git push